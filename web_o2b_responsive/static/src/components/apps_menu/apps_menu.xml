<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright 2018 Tecnativa - Jairo Llopis
     Copyright 2021 ITerra - Sergey Shebanin
     License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl). -->
<templates>
    <t t-inherit="web.NavBar.AppsMenu" t-inherit-mode="extension" owl="1">
        <xpath expr="//Dropdown" position="replace">
            <!-- Same hotkey as in EE -->
            <AppsMenu hotkey="'a'" title="'Home Menu'" manualOnly="true" class="o_navbar_apps_menu">
                <t t-set-slot="toggler">
                    <i class="fa fa-th-large" />
                </t>
                <t t-transition="o_notification_fade">
                    <AppsMenuSearchBar />
                    <MenuItem t-foreach="apps" t-as="app" t-key="app.id" class="o_app" t-att-class="{ o_dropdown_active: menuService.getCurrentApp() === app }" payload="app">
                    <a t-att-href="getMenuItemHref(app)">
                        <img class="o-app-icon" draggable="false" t-attf-src="data:image/png;base64,{{app.webIconData}}" />
                        <div t-esc="app.name" />
                    </a>
                    </MenuItem>
                </t>
            </AppsMenu>
        </xpath>
    </t>
    <!-- Search bar -->
    <t t-name="web_o2b_responsive.AppsMenuSearchResults" owl="1">
        <div class="search-container" t-att-class="state.results.length ? 'has-results' : ''">
            <div class="search-input">
                <!-- <span class="fa fa-search search-icon" /> -->
                <input type="search" t-ref="SearchBarInput" t-on-input="_searchMenus" t-on-keydown="_onKeyDown" autocomplete="off" placeholder="Search menus..." class="form-control" />
            </div>
            <!-- new Script added -->
            <!-- <t t-jquery="[t-as=app]" t-operation="before"> -->
            <!-- <div class="search-container align-items-center col-12" style="margin-top: 43px;">
                <div class="search-input">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="fa fa-search" />
                        </div>
                        <input type="search" autocomplete="off" placeholder="Search menus..." class="form-control" />
                    </div>
                    <div class="search-results ml-auto mr-auto rounded" />
                </div>
            </div> -->
            <style>
                .display {
                        display: none;
                        pointer-events: fill;
                    }
                .displ
                    {
                        pointer-events: none;
                    }

                .displuser {
                    pointer-events: all;
                }
                #displuser {
                    pointer-events: all;
                }

                .displcontent
                {
                    pointer-events: none;
                    opacity: 0.5;
                }
            </style>
            <script>
              var expir_date = $.ajax({
            type: 'GET',
            url: '/get/expire_date/',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },

            async: false,
            dataType: 'json',
            data: {},
            done: function(results) {
                return results;
            },
        }).responseJSON;

        var expire_values = $.ajax({
            type: 'GET',
            url: '/get/expire_values/',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },

            async: false,
            dataType: 'json',
            data: {},
            done: function(results) {
                return results;
            },
        }).responseJSON;

        var subscription_id = $.ajax({
            type: 'GET',
            url: '/get/get_param_values/',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },

            async: false,
            dataType: 'json',
            data: {},
            done: function(results) {
                return results;
            },
        }).responseJSON;

        if ((subscription_id &amp;&amp; subscription_id === 'trial' &amp;&amp;expire_values &amp;&amp; expire_values != true &amp;&amp; 'diffdays' in expire_values)) {
            $('.renew_form').removeClass('display');
            $('.oe_register').removeClass('display');
            $('.trialdb').removeClass('display');
            $('.diffdays').text(expire_values.diffdays);
            }
        else if ((subscription_id &amp;&amp; subscription_id !== 'trial' &amp;&amp; expire_values &amp;&amp; expire_values != true &amp;&amp; 'diffdays' in expire_values &amp;&amp; 'period' in expire_values &amp;&amp; expire_values.period === 'monthly' &amp;&amp; expire_values.diffdays &lt;=15))  {
            $('.renew_form').removeClass('display');
            $('.livedb').removeClass('display');
            $('.diffdays').text(expire_values.diffdays);
            $('.oe_renew').removeClass('display');
        }
        else if ((subscription_id &amp;&amp; subscription_id !== 'trial' &amp;&amp; expire_values &amp;&amp; expire_values != true &amp;&amp; 'diffdays' in expire_values &amp;&amp; 'period' in expire_values &amp;&amp; expire_values.period === 'annually' &amp;&amp; expire_values.diffdays &lt;= 30)) {
            $('.renew_form').removeClass('display');
            $('.livedb').removeClass('display');
            $('.diffdays').text(expire_values.diffdays);
            $('.oe_renew').removeClass('display');
        }
        else if (subscription_id &amp;&amp; subscription_id === 'trial' &amp;&amp; expire_values) {
            $('.o_main_navbar').addClass('displ');
            $('.o_action_manager').addClass('displcontent');
            $('.o_action').addClass('displcontent');
            $('.o_user_menu').addClass('displuser');
            $('.o_navbar_apps_menu').addClass('displuser');
            $('.o_navbar_apps_menu').attr('id', 'displuser');
            $('.renew_form').removeClass('display');
            $('.trialdbexpired').removeClass('display');
            $('.oe_register').removeClass('display');
        }
        else if (expire_values &amp;&amp; expire_values === true) {
            $('.o_main_navbar').addClass('displ');
            $('.o_action_manager').addClass('displcontent');
            $('.o_action').addClass('displcontent');
            $('.o_user_menu').addClass('displuser');
            $('.o_navbar_apps_menu').addClass('displuser');
            $('.renew_form').removeClass('display');
            $('.dbexpired').removeClass('display');
            $('.oe_renew').removeClass('display');
        }
        if ((subscription_id &amp;&amp; subscription_id !== 'trial' &amp;&amp; expire_values &amp;&amp; expire_values != true &amp;&amp; 'ext_apps' in expire_values &amp;&amp; 'ext_users' in expire_values)) {
            if (expire_values.ext_apps === 'yes' &amp;&amp; expire_values.ext_users === 'yes') {
                $('.extappuser').removeClass('display');
            } else if (expire_values.ext_apps === 'yes' &amp;&amp; expire_values.ext_users === 'no') {
                $('.extapp').removeClass('display');
            } else if (expire_values.ext_apps === 'no' &amp;&amp; expire_values.ext_users === 'yes') {
                $('.extuser').removeClass('display');
            }
        }

    </script>
            <script>function subscribe(){
          
          var subscription = document.getElementById("o2b_fname").value;
          var alertmsg = document.getElementById("alertmsg").style.display;


    var resp = $.ajax({
        type: 'POST',
        url: '/o2b/get_dbuuid',
        headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
         
        async: false,
        dataType: 'json',
        data: {},
        done: function(results) {
            return results;
        },
    }).responseJSON;

    var dbuuid = resp.dbuuid;
    var base_domain = resp.base_domain;
    var altli = document.getElementById("altli").setAttribute("href", base_domain + '/help');


   data = {'subscription_id' :  subscription, 'dbuuid': dbuuid};
    

    var subscription_date = $.ajax({
        type: 'POST',
        url: base_domain + '/o2b/js/subscription_date',
        headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
         
        async: false,
        dataType: 'json',
        data: data,
        done: function(results) {
            return results;
        },
    }).responseJSON;

    if(subscription_date == undefined){
      document.getElementById("alertmsg").style.display = 'block';
    }

    if(subscription_date != undefined){

     var subscription_set = $.ajax({
        type: 'POST',
        url: '/o2b/set_date',
        headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
         
        async: false,
        dataType: 'json',
        data: subscription_date,
        done: function(results) {
            return results;
        },
    }).responseJSON;

    return location.reload();
    location.reload();
    }   
}
        </script>
            <span id="extappuser" class="extappuser display" style="margin-left: 15%;color: white;">
                <h4>You have more apps and users than your membership allows. Kindly upgrade your membership.</h4>
            </span>
            <span id="extapp" class="extapp display" style="margin-left: 15%;color: white;">
                <h3>You have more apps than your membership allows. Kindly upgrade your membership.</h3>
            </span>
            <span id="extuser" class="extuser display" style="margin-left: 15%;color: white;">
                <h3>You have more users than your membership allows. Kindly upgrade your membership.</h3>
            </span>
            <h3 id="dbexpired" class="dbexpired display" style="margin: auto;color: white;">
                This database has been expired. Kindly renew your membership.
            </h3>
            <h3 id="trialdbexpired" class="trialdbexpired display" style="margin: auto;color: white;">
                This trial database has been expired. Kindly register your membership.
            </h3>
            <h3 id="trialdb" class="trialdb display" style="margin: auto; color:white;">
                This database is running in trial mode and will expire in <span class="diffdays" /> days. Kindly Register
            </h3>
            <h3 id="livedb" class="livedb display" style="margin: auto;color: white;">
                This database will expire in <span class="diffdays" /> days. Kindly renew your membership.
            </h3>
            <span id="alertmsg" style="display: none; margin: auto;color: white;" class="oe_subscription_error">
                <b>This membership id is not matching with this database while renew. You can try again or contact </b> <a id="altli" style="color: #fefefe;" href="#" target="_blank">O2b Help</a>.
            </span>
            <form class="form-inline justify-content-center mt-4 renew_form display" style="width: 94%; height: 5%; margin-left: 2%;z-index: 1; pointer-events: fill;margin-bottom: 2%;">
                <div class="form-group" style="margin-bottom: 0%;">
                    <input type="text" id="o2b_fname" class="form-control mx-2" name="subscription_id" placeholder="Your Membership Id ..." />
                </div>
                <input type="button" name="renew" onclick="subscribe();" value="Renew" class="btn btn-primary oe_form_button oe_renew display" style="background-color:#353530; " />
                <input type="button" name="renew" onclick="subscribe();" value="Register" class="btn btn-primary oe_form_button oe_register display" style="background-color:#353530; " />
            </form>
            <div t-if="state.results.length" class="search-results">
                <t t-foreach="state.results" t-as="result">
                    <t t-set="menu" t-value="_menuInfo(result)" />
                    <a t-attf-class="search-result {{result_index == state.offset ? 'highlight' : ''}}" t-att-style="menu.webIconData ? &quot;background-image:url('data:image/png;base64,&quot; + menu.webIconData + &quot;')&quot; : ''" t-attf-href="#menu_id={{menu.id}}&amp;action_id={{menu.actionID}}" t-att-data-menu-id="menu.id" t-att-data-action-id="menu.actionID" draggable="false" t-esc="result" />
                </t>
            </div>
        </div>
    </t>
    <t t-inherit="web.Dropdown" t-inherit-mode="extension" owl="1">
        <xpath expr="//div[hasclass('dropdown-menu')]" position="attributes">
            <attribute name="t-transition">fade</attribute>
        </xpath>
        <xpath expr="//div[@t-ref='menuRef']" position="attributes">
            <attribute name="t-attf-style">
                background-image: url("{{ backgroundImageUrl }}");
            </attribute>
        </xpath>
    </t>
</templates>