<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_ticket_management_tree" model="ir.ui.view">
        <field name="name">ticket.management.tree</field>
        <field name="model">ticket.management</field>
        <field name="arch" type="xml">
            <tree string="Tickets"
                  decoration-muted="state == 'draft'"
                  decoration-warning="state == 'client_feedback'"
                  decoration-info="state == 'acknowledgement'"
                  decoration-primary="state == 'work_in'"
                  decoration-success="state == 'closed'"
                  decoration-danger="state == 'work_out'" multi_edit="1" sample="1">

                <field name="random_ticket" string="Ticket Number"/>
                <field name="create_date" string="Created Date" />
                <field name="ticket_type" string="Ticket Type"/>
<!--                <field name="employee_id" string="Team"/>-->
                <field name="customer_id" string="Reported By/Owner" optional="hide"/>
                <field name="parent" string="Solution" optional="hide"/>
                <field name="child_menu" string="Menu Option"/>
                <field name="grandchild_menu" string="Menu Module" optional="hide"/>
                <field name="remark" string="Remarks" optional="hide"/>
                <field name="priority" string="Priority" widget="badge"
                       decoration-danger="priority == 'urgent'"
                       decoration-warning="priority == 'high'"
                       decoration-primary="priority == 'medium'"
                       decoration-muted="priority == 'low'"/>
                <field name="random_code" string="Object Code"/>
                <field name="state" string="Status" widget="badge"
                       decoration-success="state == 'closed'"
                       decoration-info="state != 'closed'"/>
                <field name="sequence_number" string="Ticket Number" invisible="1"/>
                <field name="user_id" string="Responsible" optional="hide"/>
                <field name="company_id" string="Company" optional="hide"/>
                <field name="closed_date" string="Close Date"  optional="hide"/>
                <field name="sla_status_done_count" string="SLA Count" optional="hide"/>


            </tree>
        </field>
    </record>


    <record id="view_ticket_management_kanban" model="ir.ui.view">
        <field name="name">ticket.management.kanban</field>
        <field name="model">ticket.management</field>
        <field name="arch" type="xml">
            <kanban string="Tickets">
                <!-- Declare all fields to be included in the Kanban view -->
                <field name="create_date"/>
                <field name="ticket_type"/>
                <field name="customer_id"/>
                <field name="parent"/>
                <field name="child_menu"/>
                <field name="grandchild_menu"/>
                <field name="remark"/>
                <field name="priority"/>
                <field name="random_code"/>
                <field name="random_ticket"/>
                <field name="state"/>
                <field name="sla_response_status"/>
                <field name="sla_resolve_status"/>
                <field name="closed_date"/>

                <field name="capture_images"/>
                <field name="sequence_number" invisible="1"/>
                <field name="user_id" widget="many2one_avatar"/>

                <templates>
                    <t t-name="kanban-box">
                        <!-- Kanban card -->
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click {{ record.state.raw_value ? 'o_state_' + record.state.raw_value : '' }}">
                            <!-- Ticket information -->
                            <div class="o_kanban_details">
                                <div>
                                    <strong>Remark:</strong>
                                    <span t-esc="record.remark.value"/>
                                </div>
                                <div>
                                    <strong>Ticket Number:</strong>
                                    <span t-esc="record.random_ticket.value"/>
                                </div>
                                <div>
                                    <strong>Reported By:</strong>
                                    <span t-esc="record.customer_id.value"/>
                                </div>
                                <div>
                                    <strong>Priority:</strong>
                                    <span t-esc="record.priority.value"/>
                                </div>
                                <div>
                                    <strong>Status:</strong>
                                    <span t-esc="record.state.value"/>
                                </div>
                                <div>
                                    <strong>Created On:</strong>
                                    <span t-esc="record.create_date.value"/>
                                </div>
                                <div>
                                    <strong>Closed Date:</strong>
                                    <span t-esc="record.closed_date.value"/>
                                </div>
                                <div>
                                    <strong>Ticket Type:</strong>
                                    <span t-esc="record.ticket_type.value"/>
                                </div>
                                <div>
                                    <strong>Application:</strong>
                                    <span t-esc="record.parent.value"/>
                                </div>
                                <div>
                                    <strong>Menu Module:</strong>
                                    <span t-esc="record.child_menu.value"/>
                                </div>
                                <div>
                                    <strong>Menu Option:</strong>
                                    <span t-esc="record.grandchild_menu.value"/>
                                </div>
                                <div>
                                    <strong>SLA Respond:</strong>
                                    <span t-esc="record.sla_response_status.value"/>

                                </div>
                                <div>
                                    <strong>SLA Resolve:</strong>
                                    <span t-esc="record.sla_resolve_status.value"/>
                                </div>

                                <div>
                                    <strong>Attached Image:</strong>
                                    <field name="capture_images">
                                        <form editable="bottom">
                                            <field name="capture_image" widget="image"/>
                                        </form>
                                    </field>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <record id="view_ticket_management_form" model="ir.ui.view">
        <field name="name">ticket.management.form</field>
        <field name="model">ticket.management</field>
        <field name="arch" type="xml">
            <form class="ticket_management_form" string="Ticket Details">

                <!-- Header with buttons and statusbar -->
                <header>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,open,acknowledgement,work_in,work_out,client_feedback,closed"/>

                    <button name="action_confirm" type="object" string="Confirm"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"
                            groups="tickets_management.group_admin"
                            class="btn btn-primary"
                            confirm="Are you sure to confirm Ticket?"/>

                    <button name="action_closed" type="object" string="Closed"
                            attrs="{'invisible': [('state', '!=', 'client_feedback')]}"

                            class="btn btn-danger"/>

                    <button name="action_open" type="object" string="Reopen"
                            attrs="{'invisible': [('state', '!=', 'client_feedback')]}"

                            class="btn btn-primary"
                            confirm="Are you sure to open Ticket?"/>

                    <button name="action_assign" type="object" string="Assign"
                             attrs="{'invisible': [('state', '!=', 'open')]}"
                            groups="tickets_management.group_admin"
                            class="btn btn-primary"/>

                    <button name="action_done" type="object" string="Done"
                            attrs="{'invisible': [('state', '!=', 'acknowledgement')]}"
                            groups="tickets_management.group_admin,tickets_management.group_employee"
                            class="btn btn-primary"/>

                    <button name="action_complete" type="object" string="Work Delivered"
                            attrs="{'invisible': [('state', '!=', 'work_in')]}"
                            groups="tickets_management.group_admin,tickets_management.group_employee"
                            class="btn btn-primary"/>


                    <button name="action_acknowledgement" type="object" string="Acknowledgement"
                            attrs="{'invisible': [('state', '!=', 'open')]}"
                            groups="tickets_management.group_admin,tickets_management.group_employee"
                            class="btn btn-primary"/>

                    <button name="action_feedback" type="object" string="Feedback"
                            attrs="{'invisible': [('state', '!=', 'work_out')]}"
                            groups="tickets_management.group_admin,tickets_management.group_employee"
                            class="btn btn-primary"/>

                    <button name="action_send_email"
                            type="object" string="Send Email"
                            icon="fa-envelope"
                            groups="tickets_management.group_admin,tickets_management.group_employee"
                            confirm="Are you sure to send mail?"
                            class="btn btn-primary"/>

                      <button name="action_open_priority_wizard"
                              type="object"
                              string="Change Priority"
                              class="btn-primary" />

                </header>

                <!-- Main form fields -->
                <sheet>

                    <group>

                        <field name="random_ticket" string="Ticket Number"
                               attrs="{'readonly': [('state', '!=', False)]}"/>

                        <field name="ticket_type" string="Ticket Type"
                               attrs="{'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="team_id" string="Team"
                               attrs="{'invisible': [('state', 'in', ['draft', 'open'])],
                               'required': [('state', '=', 'acknowledgement')],
                               'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="employee_ids_id" string="Assign User"
                               attrs="{'invisible': [('state', 'in', ['draft', 'open'])],
                               'required': [('state', '=', 'acknowledgement')],
                               'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="user_id" string="Reported By/Owner"
                               attrs="{'readonly': [('state', '=', 'draft')]}" options="{'no_create': True}"/>

                        <field name="company_id" string="Company"
                               attrs="{'readonly': [('state', '=', 'draft')]}" options="{'no_create': True}"/>

                        <field name="parent" string="Application"
                               attrs="{'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="child_menu" string="Menu Module"
                               attrs="{'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="grandchild_menu" string="Menu Option"
                               attrs="{'readonly': [('state', '=', 'closed')]}" options="{'no_create': True}"/>

                        <field name="remark" string="Remarks" default_focus="1" attrs="{'readonly': [('state', '=', 'closed')]}"/>

                       <field name="employee_ids" invisible="1"/>





                        <field name="priority" string="Priority"
                               attrs="{'readonly': ['|', ('state', '=', 'closed'), ('priority', '!=', False)]}" force_save='True'/>

                        <field name="capture_images">
                            <form editable="bottom">
                                <field name="capture_image" />
                            </form>
                        </field>
                    </group>
                    <group>
                        <field name="respond_deadline" invisible="1"/>
                        <field name="resolve_deadline" invisible="1"/>
                        <field name="sla_response_status" invisible="1"/>
                        <field name="sla_resolve_status" invisible="1"/>

                    </group>
                    <notebook>
                        <page string="Description">
                            <sheet>
                                <field name="description"/>
                            </sheet>
                        </page>

                        <page string="Other Information" groups="tickets_management.group_admin,tickets_management.group_employee">
                            <group>

                                <field name="last_stage_update" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                <field name="phone" widget="phone"/>
                                <field name="email"/>
                                <field name="assigned_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                <field name="feedback_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                <field name="closed_date"
                                       attrs="{'required': [('state', '=', 'closed')],
                                               'readonly': [('state', '!=', 'draft')]}"/>

                            </group>
                        </page>

                        <page string="Remarks History" groups="tickets_management.group_admin,tickets_management.group_employee">
                            <sheet>
                                <group>
                                    <group>
                                        <field name="all_remarks"/>
                                    </group>
                                </group>
                            </sheet>
                        </page>
                        <page string="Customer Rating">
                            <sheet>
                                <group>
                                    <field name="customer_rating" widget="priority"/>
                                    <field name="comment"/>
                                </group>
                            </sheet>
                        </page>

                    </notebook>

                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids" options="{'open_attachments': True}"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_ticket_management_search" model="ir.ui.view">
        <field name="name">ticket.management.search</field>
        <field name="model">ticket.management</field>
        <field name="arch" type="xml">
            <search>
                <field name="random_code"/>
                <field name="random_ticket"/>
            </search>
        </field>
    </record>


    <record id="action_ticket_management" model="ir.actions.act_window">
        <field name="name">Raise Support Ticket</field>
        <field name="res_model">ticket.management</field>
        <field name="view_mode">tree,form,kanban,search</field>
        <field name="help" type="html">
            <p>
                Create, view, and manage tickets for better support.
            </p>

        </field>
    </record>


</odoo>


